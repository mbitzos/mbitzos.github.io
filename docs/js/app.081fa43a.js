(function(e){function t(t){for(var a,i,s=t[0],c=t[1],l=t[2],d=0,h=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&h.push(r[i][0]),r[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(h.length)h.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(a=!1)}a&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},r={app:0},o=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"00df":function(e,t,n){},"0a4d":function(e,t,n){e.exports=n.p+"img/unity-logo.80de313e.png"},1771:function(e,t,n){var a={"./about/digital_face.png":"683f","./about/face1.jpg":"96fb","./about/favicon-image.png":"a5b1","./about/java-logo.svg":"7106","./about/mongodb.jpg":"be36","./about/os-logo.png":"6867","./about/python.png":"4f3a","./about/unity-logo.png":"0a4d","./about/vue-logo.png":"b3ff","./about/vue-logo.svg":"7cce","./fonts/AkagiPro-Black.ttf":"d0122","./fonts/AkagiPro-Light.ttf":"421b","./main.scss":"b383","./posts/fsm-player-controllers/cover.jpg":"ef7d","./posts/fsm-player-controllers/fsm-locked-door.jpg":"e06c","./posts/fsm-player-controllers/fsm-quest.jpg":"d6a1","./posts/programmatic-animation-using-coroutines/ambient-lighting-animations.gif":"ac6c","./posts/programmatic-animation-using-coroutines/animation-curve-editor.jpg":"33c1","./posts/programmatic-animation-using-coroutines/animation-curves.gif":"fc91","./posts/programmatic-animation-using-coroutines/attack-dash-animations.gif":"9f0b","./posts/programmatic-animation-using-coroutines/card-deck-animation.gif":"40cc"};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=o,e.exports=r,r.id="1771"},"1e70":function(e,t,n){},"25c1":function(e,t,n){"use strict";n("958e")},"33c1":function(e,t,n){e.exports=n.p+"img/animation-curve-editor.a99888a7.jpg"},3419:function(e,t,n){"use strict";n("dc6b")},"40cc":function(e,t,n){e.exports=n.p+"img/card-deck-animation.5a9ceaf8.gif"},"421b":function(e,t,n){e.exports=n.p+"fonts/AkagiPro-Light.d9114d22.ttf"},"44d2f":function(e,t,n){"use strict";n("6a5b")},"4f3a":function(e,t,n){e.exports=n.p+"img/python.05d8e48a.png"},"5b33":function(e,t,n){},"5bb1":function(e,t,n){"use strict";n("00df")},"67c5":function(e,t,n){"use strict";n("1e70")},"683f":function(e,t,n){e.exports=n.p+"img/digital_face.756e905f.png"},6867:function(e,t,n){e.exports=n.p+"img/os-logo.296364b9.png"},"6a5b":function(e,t,n){},7106:function(e,t,n){e.exports=n.p+"img/java-logo.84321945.svg"},"7cce":function(e,t,n){e.exports=n.p+"img/vue-logo.6fb1734b.svg"},"8ae2":function(e,t,n){},"958e":function(e,t,n){},"96fb":function(e,t,n){e.exports=n.p+"img/face1.b52cfc22.jpg"},"9f0b":function(e,t,n){e.exports=n.p+"img/attack-dash-animations.b0305274.gif"},a5b1:function(e,t,n){e.exports=n.p+"img/favicon-image.b3ab9557.png"},ac6c:function(e,t,n){e.exports=n.p+"img/ambient-lighting-animations.68e7cdfc.gif"},b383:function(e,t,n){},b3ff:function(e,t,n){e.exports=n.p+"img/vue-logo.96e5850d.png"},be36:function(e,t,n){e.exports=n.p+"img/mongodb.9b024a60.jpg"},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("cd17");var a=n("7a23");function r(e,t,n,r,o,i){var s=Object(a["z"])("router-view");return Object(a["r"])(),Object(a["d"])(s)}var o=Object(a["i"])({methods:{hello:function(){console.log("hello and welcome to my website."),console.log("currently working on building my gamedev blog, check it out: michaelbitzos.com/devblog"),console.log("This was made with Vue3 and TS. I don't know why I did this but here we are.")}},created:function(){this.hello()}});n("3419");o.render=r;var i=o,s=(n("d81d"),n("6c02")),c=n("96fb"),l=n.n(c),u=n("4f3a"),d=n.n(u),h=n("be36"),p=n.n(h),m=n("b3ff"),b=n.n(m),f=n("7106"),y=n.n(f),g=n("0a4d"),O=n.n(g),v=n("6867"),j=n.n(v),S=Object(a["G"])("data-v-588d6188");Object(a["u"])("data-v-588d6188");var w={class:"content col"},k=Object(a["h"])("div",{id:"header",class:"row"},[Object(a["h"])("div",{id:"header-text",class:"col"},[Object(a["h"])("div",{class:"hey"},"hey,"),Object(a["h"])("div",{class:"name"},"i'm michael bitzos.")]),Object(a["h"])("div",{class:"headshot-container"},[Object(a["h"])("img",{src:l.a})])],-1),M=Object(a["h"])("hr",{id:"hr-1",class:"gradient-line left"},null,-1),x=Object(a["h"])("div",{id:"software-developer",class:"row"},[Object(a["h"])("div",{class:"icon-container row"},[Object(a["h"])("div",{id:"python"},[Object(a["h"])("img",{src:d.a})]),Object(a["h"])("div",{id:"mongo"},[Object(a["h"])("img",{src:p.a})]),Object(a["h"])("div",{id:"vue",class:"small"},[Object(a["h"])("img",{src:b.a})]),Object(a["h"])("div",{id:"java",class:"small"},[Object(a["h"])("img",{src:y.a})])]),Object(a["h"])("div",null,[Object(a["h"])("div",{class:"text-block-header header"}," i'm a software developer professionally. "),Object(a["h"])("div",{class:"text-block"},[Object(a["h"])("div",null,"i currently work with python & mongodb."),Object(a["h"])("div",null,"i used to do a lot of vue.js & java."),Object(a["h"])("div",null,[Object(a["g"])(" here's my "),Object(a["h"])("a",{href:"./Michael-Bitzos-Resume.pdf",target:"_blank"},"resume")]),Object(a["h"])("div",null,[Object(a["g"])(" here's my "),Object(a["h"])("a",{href:"https://github.com/mbitzos",target:"_black"},"github")])])])],-1),F=Object(a["h"])("hr",{id:"hr-2",class:"gradient-line right"},null,-1),C={id:"game-developer",class:"row"},P=Object(a["h"])("div",{class:"text-block-header header"}," i'm a game developer on the side. ",-1),I={class:"text-block"},T=Object(a["g"])(" i'm writing blogs about my experience "),E=Object(a["g"])("here."),D=Object(a["h"])("div",null,[Object(a["g"])(" been makin' things in unity 2"),Object(a["h"])("span",{style:{"text-transform":"initial"}},"D"),Object(a["g"])(" for a while. ")],-1),U=Object(a["h"])("div",{class:"icon-container row"},[Object(a["h"])("div",{id:"unity"},[Object(a["h"])("img",{src:O.a})]),Object(a["h"])("div",{id:"overlook"},[Object(a["h"])("img",{src:j.a})])],-1),A=Object(a["h"])("hr",{id:"hr-3"},null,-1),z=Object(a["h"])("div",{id:"contact"},[Object(a["h"])("div",{class:"header"},"contact me"),Object(a["h"])("div",{class:"row"},[Object(a["h"])("div",{class:"contacts"},[Object(a["h"])("a",{href:"mailto:mbitzos@gmail.com"},"email"),Object(a["h"])("a",{href:"https://www.linkedin.com/in/michaelbitzos/",target:"_blank"},"linkedin")])])],-1);Object(a["s"])();var _=S((function(e,t,n,r,o,i){var s=Object(a["z"])("router-link");return Object(a["r"])(),Object(a["d"])("div",w,[k,M,x,F,Object(a["h"])("div",C,[Object(a["h"])("div",null,[P,Object(a["h"])("div",I,[Object(a["h"])("div",null,[T,Object(a["h"])(s,{to:"devblog"},{default:S((function(){return[E]})),_:1})]),D])]),U]),A,z])})),B=Object(a["i"])({});n("fc94");B.render=_,B.__scopeId="data-v-588d6188";var q=B,G=n("683f"),W=n.n(G),L={id:"devblog"},H={id:"navbar"},R=Object(a["h"])("div",{class:"title-container"},[Object(a["h"])("div",{class:"title"},[Object(a["g"])("michael bitzos "),Object(a["h"])("span",null,"[devblog]")]),Object(a["h"])("div",{class:"subtitle is-5"}," writin' about gamedev. ")],-1),N=Object(a["h"])("div",{id:"navbar-border"},null,-1),K=Object(a["h"])("div",{id:"navbar-border",class:"second"},null,-1),$={id:"main-content"},Y=Object(a["h"])("div",{id:"sidebar-border"},null,-1),J=Object(a["h"])("div",{id:"sidebar-dot"},null,-1),Z={id:"post-container"};function V(e,t,n,r,o,i){var s=Object(a["z"])("router-link"),c=Object(a["z"])("sidebar"),l=Object(a["z"])("router-view");return Object(a["r"])(),Object(a["d"])("div",L,[Object(a["h"])("div",H,[Object(a["h"])(s,{to:"/",custom:""},{default:Object(a["F"])((function(e){var t=e.navigate;return[Object(a["h"])("img",{onClick:t,title:"Art by Adam Mawby!",class:"face",src:W.a,role:"link"},null,8,["onClick"])]})),_:1}),R]),N,K,Object(a["h"])("div",$,[Object(a["h"])("div",{id:"sidebar-expander",class:{open:e.open}},[Object(a["g"])(Object(a["C"])(e.open?"‹":"›")+" ",1),Object(a["h"])("div",{onClick:t[1]||(t[1]=function(){return e.toggleOpen&&e.toggleOpen.apply(e,arguments)})})],2),Object(a["h"])("div",{id:"sidebar-container",class:{open:e.open}},[Object(a["h"])(c)],2),Object(a["h"])("div",{id:"blackout",onClick:t[2]||(t[2]=function(t){return e.open=!1}),class:{show:e.open}},null,2),Y,J,Object(a["h"])("div",Z,[Object(a["h"])(l,{key:e.$route.fullPath})])])])}var X={id:"sidebar"},Q=Object(a["h"])("div",{class:"title is-6"}," Articles ",-1),ee={class:"articles"},te={key:0};function ne(e,t,n,r,o,i){var s=Object(a["z"])("router-link");return Object(a["r"])(),Object(a["d"])("div",X,[Q,Object(a["h"])("ul",ee,[(Object(a["r"])(!0),Object(a["d"])(a["a"],null,Object(a["x"])(e.articles,(function(t){return Object(a["r"])(),Object(a["d"])("li",{key:t.key},[e.isSelected(t)?(Object(a["r"])(),Object(a["d"])("div",te,Object(a["C"])(t.title),1)):(Object(a["r"])(),Object(a["d"])(s,{key:1,to:"/devblog/".concat(t.key)},{default:Object(a["F"])((function(){return[Object(a["g"])(Object(a["C"])(t.title),1)]})),_:2},1032,["to"]))])})),128))])])}n("b0c0");var ae=n("5c40"),re=Object(a["f"])('<p> One of the biggest mistakes beginner programmers make is defining classes and functions with too many responsibilities. For game developers this is often seen in the code that models your main playable entity in the game, ie the player controller. By managing too many responsibilities in a single place you are making it harder for yourself to grow, maintain, and debug your codebase. </p><p> With the accessibility of Unity&#39;s pre-built update loops (<code>Update</code>, <code>FixedUpdate</code>, <code>LateUpdate</code>) it is extremely easy to find yourself writing an unwieldy amount of code to control your player in a single class. With an unorganized mess of <code>if/elses</code>, edge cases, and a string of mechanics interspersed within one another, this becomes a nightmare in the present, and untenable in the future. </p><p> Online Unity tutorials and introductory materials tend to stress the use of the <code>Update</code> method for showcasing code. Placing large chunks of code here gives newcomers the impression that this is where the bulk of code should reside. These tutorials meant to show you snippets of prototype implementations fail to demonstrate the kind of infrastructure needed to work on long term projects with evolving requirements, nor should they. </p><p> This is one of difficulties I experienced when first getting into Unity and learning programming. The steps below breakdown how I am able to build a player controller beyond the prototype by utilizing finite state machines to cleanly manage my player states all while avoiding any of the mess of <code>if/else</code> or <code>switch</code> statements. </p><h2 id="finitestatemachines">Finite state machines</h2><p> A finite state machine (FSM) is a mathematical model described as a system that contains states, a reference to the current state, transitions connecting states together, and inputs/conditions that trigger the transition from one state to another. If you have any experience creating animations in Unity, Mecanim is a perfect example of what a state machine accomplishes. </p><p> A lot of game mechanics are implicitly designed as some form of a state machine since most things in a game are intrinsically stateful. They contain some model data that when some conditions are met will result in a change in its behaviour. </p>',7),oe=Object(a["h"])("p",null," As you can see, it is very easy to design even the most basic mechanics as FSMs because it allows you to break down complex problems into understandable mental models. In the next section I will show how you can create an FSM framework that will help you build out your player controller. ",-1),ie=Object(a["h"])("h2",{id:"theimplementation"},"The implementation",-1),se=Object(a["h"])("p",null," The following are all essential classes you will need for your FSM framework: ",-1),ce=Object(a["h"])("h3",{id:"finitestatemachinecs"},"FiniteStateMachine.cs",-1),le=Object(a["h"])("pre",null,[Object(a["h"])("code",{class:"csharp language-csharp"},'/// <summary>\r\n/// Models a basic finite state machine\r\n/// Manages all the states in the FSM including transitions\r\n/// </summary>\r\npublic class FiniteStateMachine {\r\n\r\n  Dictionary<Type, State> states = new Dictionary<Type, State>();\r\n\r\n  public State currentState {\r\n    get;\r\n    private set;\r\n  }\r\n  State defaultState;\r\n\r\n  PlayerController player;\r\n\r\n  /// <summary>\r\n  /// Constructs a new finite state machine\r\n  /// </summary>\r\n  public FiniteStateMachine(PlayerController player) {\r\n    this.player = player;\r\n  }\r\n\r\n  /// <summary>\r\n  /// Initializes the FSM with the states \r\n  /// </summary>\r\n  protected void setStates(List<State> states, State defaultState) {\r\n    this.states.Clear();\r\n    foreach (var state in states) {\r\n      this.states.Add(state.GetType(), state);\r\n    }\r\n    this.defaultState = defaultState;\r\n  }\r\n\r\n  /// <summary>\r\n  /// Starts the FSM\r\n  /// </summary>\r\n  public void Start() {\r\n    this.ChangeState(defaultState);\r\n  }\r\n\r\n  /// <summary>\r\n  /// Triggers an update\r\n  /// </summary>\r\n  public void Update() {\r\n    if (currentState != null)\r\n      currentState.Update();\r\n  }\r\n\r\n  /// <summary>\r\n  /// triggers a fixed Update\r\n  /// </summary>\r\n  public void FixedUpdate() {\r\n    if (currentState != null)\r\n      currentState.FixedUpdate();\r\n  }\r\n\r\n  /// <summary>\r\n  /// Change to new state\r\n  /// </summary>\r\n  /// <typeparam name="S">The state to change to</typeparam>\r\n  public void ChangeState<S>() where S : State {\r\n    ChangeState(states[typeof(S)]);\r\n  }\r\n\r\n  /// <summary>\r\n  /// Change to new state\r\n  /// </summary>\r\n  /// <typeparam name="S">The state to change to</typeparam>\r\n  public void ChangeState(State state) {\r\n    if (currentState != null) {\r\n      currentState.OnExit();\r\n    }\r\n    currentState = state;\r\n    currentState.OnEnter();\r\n  }\r\n\r\n  /// <summary>\r\n  /// Changes to current state\r\n  /// </summary>\r\n  public void ChangeToDefault() {\r\n    ChangeState(defaultState);\r\n  }\r\n}\r\n')],-1),ue=Object(a["h"])("p",null," This is the main orchestrator of the states and is to be the singular place we interface with the FSM framework. The FSM has basic functionality including the ability to provide the current state, set a default one, and of course change the current state. ",-1),de=Object(a["h"])("h3",{id:"statecs"},"State.cs",-1),he=Object(a["h"])("pre",null,[Object(a["h"])("code",{class:"csharp language-csharp"},"/// <summary>\r\n/// Models a state in a basic FSM\r\n/// </summary>\r\npublic abstract class State {\r\n  protected FiniteStateMachine fsm;\r\n  protected PlayerController player;\r\n\r\n  public State(FiniteStateMachine fsm, PlayerController player) {\r\n    this.player = player;\r\n    this.fsm = fsm;\r\n  }\r\n\r\n  /// <summary>\r\n  /// What to do on entering the state\r\n  /// </summary>\r\n  public abstract void OnEnter();\r\n\r\n  /// <summary>\r\n  /// What to do on exiting the state\r\n  /// </summary>\r\n  public abstract void OnExit();\r\n\r\n  public abstract void Update();\r\n  public abstract void FixedUpdate();\r\n\r\n  /// <summary>\r\n  /// Goes to a new state (Wrapper for ChangeState)\r\n  /// </summary>\r\n  public void Goto<S>() where S : State {\r\n    fsm.ChangeState<S>();\r\n  }\r\n\r\n  /// <summary>\r\n  /// Changes to default\r\n  /// </summary>\r\n  public void GoToDefault() {\r\n    fsm.ChangeToDefault();\r\n  }\r\n}\r\n")],-1),pe=Object(a["f"])('<p> This is an abstract implementation of a single state in your FSM that allows you implement it&#39;s lifecycle hooks via inheritance. Along with the player it will also contain a reference to your FSM itself so that the states can easily request to change to another state. You&#39;ll notice that neither of these classes are extending from Unity&#39;s <code>MonoBehaviour</code> class, meaning they will not function as components you attach to your gameobjects. This will instead be used as a basic C# object that gets instantiated and has its lifecycle methods called via your <code>PlayerController</code>, below you can see an example of this. This method is simply a preference of mine as I quite enjoy the engine-agnostic aspect of this implementation. </p><p> I was interested in how this would look as a game object component so I went ahead and created one <a href="https://github.com/mbitzos/devblog-code-examples/tree/main/fsm-player-controllers/monobehaviour-example">here.</a> In retrospect I think this approach is better for Unity specifically since <code>GetComponent</code> removes a lot of the boilerplate and lets us utilize Unity&#39;s serialization for state class variables. For my next project I&#39;ll be sure to try out this out to see how the two differ! </p><p> The rest of the article is independent of this decision so don&#39;t fret if you decide to go with either implementation. </p><p> Another thing you&#39;ll notice is that my original definition of a FSM contains the concept of &quot;states&quot; and &quot;transitions&quot;. By comparison, my implementation doesn&#39;t explicitly define transitions as I believe them to be redundant for the use case of player state management. The focus of the FSM implementation is to decouple player state from the controller, the transitions are hardly the focus here and were less important for my use-case as well. This solution provides a great balance of strict separation of states with the freedom of transition control. </p><h2 id="example">Example</h2><p> Below is a barebones example of how I would implement a FSM for a player controller in an RPG. </p>',6),me=Object(a["h"])("pre",null,[Object(a["h"])("code",{class:"csharp language-csharp"},"/// <summary>\r\n/// Models a basic fsm for a player\r\n/// </summary>\r\npublic class PlayerFSM : FiniteStateMachine {\r\n  public PlayerFSM(PlayerController player) : base(player) {\r\n    var defaultState = new DefaultState(this, player);\r\n    var states = new List<State>() {\r\n      defaultState,\r\n      new DashState(this, player),\r\n      new AttackState(this, player),\r\n      new DeathState(this, player),\r\n    };\r\n    setStates(states, defaultState);\r\n  }\r\n}\r\n\r\n/// <summary>\r\n/// Default state to control the player\r\n/// </summary>\r\npublic class DefaultState : State {\r\n  public DefaultState(FiniteStateMachine fsm, PlayerController player) : base(fsm, player) { }\r\n\r\n  public override void FixedUpdate() { }\r\n\r\n  public override void OnEnter() { }\r\n\r\n  public override void OnExit() { }\r\n\r\n  public override void Update() {\r\n    if (Input.GetKeyDown(KeyCode.Space)) {\r\n      Goto<DashState>();\r\n    }\r\n    // handle basic player movement physics + animation\r\n  }\r\n}\r\n\r\n/// <summary>\r\n/// Models when the player is performing an attack \r\n/// </summary>\r\npublic class AttackState : State {\r\n  public AttackState(FiniteStateMachine fsm, PlayerController player) : base(fsm, player) { }\r\n\r\n  public override void OnEnter() {\r\n    // Start attack animation\r\n  }\r\n\r\n  public override void OnExit() {\r\n    // End attack animation\r\n  }\r\n\r\n  public override void Update() { }\r\n\r\n  public override void FixedUpdate() {\r\n    // perform attack physics movement\r\n  }\r\n}\r\n\r\n/// <summary>\r\n/// Models the state when the player dashes\r\n/// </summary>\r\npublic class DashState : State {\r\n  public DashState(FiniteStateMachine fsm, PlayerController player) : base(fsm, player) { }\r\n\r\n  public override void OnEnter() {\r\n    // start dash animation\r\n    // start i-frames\r\n  }\r\n\r\n  public override void OnExit() {\r\n    // stop i-frames\r\n  }\r\n\r\n  public override void FixedUpdate() {\r\n    // perform dash physics\r\n  }\r\n  public override void Update() { }\r\n}\r\n\r\n/// <summary>\r\n/// Models the state when the player is dead \r\n/// </summary>\r\npublic class DeathState : State {\r\n  public DeathState(FiniteStateMachine fsm, PlayerController player) : base(fsm, player) { }\r\n\r\n  public override void OnEnter() {\r\n    // death animation\r\n    // game over\r\n    // stop inputs\r\n  }\r\n\r\n  public override void OnExit() { }\r\n\r\n  public override void Update() { }\r\n\r\n  public override void FixedUpdate() { }\r\n}\r\n")],-1),be=Object(a["h"])("h2",{id:"beyond"},"Beyond",-1),fe=Object(a["h"])("p",null," There is a ton we can do to further improve our FSM framework, it's up to you whether these features could help in your use-case but I recommend all of these for those that want to take their technical skills to the next level. ",-1),ye=Object(a["h"])("h3",{id:"utilizinggenerics"},"Utilizing Generics",-1),ge=Object(a["h"])("p",null,[Object(a["g"])(" The above design is strictly for our player controller, but what if we have other things in our game that want to utilize a FSM? One solution is that we could design a FSM that expects to pass in a "),Object(a["h"])("code",null,"MonoBehaviour"),Object(a["g"])(" object, but that would require us to cast it everywhere. ")],-1),Oe=Object(a["h"])("pre",null,[Object(a["h"])("code",{class:"csharp language-csharp"},"public class ExampleState : State {\r\n  public ExampleState(FiniteStateMachine fsm, Monobehaviour stateObject) : base(fsm, stateObject) {}\r\n  public override void Update() {\r\n    PlayerController player = stateObject as PlayerController; // :'(\r\n    if (Input.GetKeyDown(KeyCode.Space)) {\r\n      player.DoSomethingSpecificToPlayer();\r\n    }\r\n  }\r\n}\r\n")],-1),ve=Object(a["h"])("p",null,[Object(a["g"])(" This is where the beauty of C#'s generics comes in to help us design an object-agnostic FSM without the drawbacks mentioned above. If you are new to generics I would suggest to first "),Object(a["h"])("a",{href:"https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/types/generics"},"read up on generics via the official C# documentation.")],-1),je=Object(a["h"])("p",null,[Object(a["g"])(" Essentially we change the definition of our FSM so that in our implementation of our states and FSM we can specify which type of "),Object(a["h"])("code",null,"MonoBehaviour"),Object(a["g"])(" we will be controlling. ")],-1),Se=Object(a["h"])("pre",null,[Object(a["h"])("code",{class:"csharp language-csharp"},'/// <summary>\r\n/// Models the finite state machine using generics\r\n/// </summary>\r\n/// <typeparam name="SO">[SO=State Object] This is the monobehaviour object that our FSM is controlling state for </typeparam>\r\npublic class FiniteStateMachine<SO> where SO : MonoBehaviour {\r\n\r\n  Dictionary<Type, State<SO>> states = new Dictionary<Type, State<SO>>();\r\n\r\n  public State<SO> currentState {\r\n    get;\r\n    private set;\r\n  }\r\n  State<SO> defaultState;\r\n\r\n  // This is the object that our FSM is controlling state for\r\n  private SO stateObject;\r\n\r\n  /// <summary>\r\n  /// Constructs a new finite state machine\r\n  /// </summary>\r\n  public FiniteStateMachine(SO stateObject) {\r\n    this.stateObject = stateObject;\r\n  }\r\n  ...\r\n}\r\n\r\n/// <summary>\r\n/// Models a state in an generic-powered FSM\r\n/// </summary>\r\n/// <typeparam name="SO">[SO=State Object] This is the object that our FSM is controlling state for </typeparam>\r\npublic abstract class State<SO> where SO : MonoBehaviour {\r\n  protected FiniteStateMachine<SO> fsm;\r\n  protected SO stateObject;\r\n\r\n  public State(FiniteStateMachine<SO> fsm, SO stateObject) {\r\n    this.stateObject = stateObject;\r\n    this.fsm = fsm;\r\n  }\r\n  ...\r\n}\r\n')],-1),we=Object(a["h"])("p",null," From there you can see how easy it is to use the same FSM framework for different controllers. ",-1),ke=Object(a["h"])("pre",null,[Object(a["h"])("code",{class:"csharp language-csharp"},"// FSM for player controller\r\n#region Player\r\npublic class PlayerFSM : FiniteStateMachine<PlayerController> {\r\n  public PlayerFSM(PlayerController player) : base(player) {\r\n    // states\r\n  }\r\n}\r\npublic abstract class BasePlayerState : State<PlayerController> {\r\n  protected BasePlayerState(PlayerFSM fsm, PlayerController player) : base(fsm, player) { }\r\n}\r\npublic class DefaultState : BasePlayerState {\r\n  public DefaultState(PlayerFSM fsm, PlayerController player) : base(fsm, player) { }\r\n}\r\n\r\n#endregion\r\n\r\n// FSM for enemy controller\r\n#region Enemy\r\npublic class EnemyFSM : FiniteStateMachine<EnemyController> {\r\n  public EnemyFSM(EnemyController enemy) : base(enemy) {\r\n    // states\r\n  }\r\n}\r\npublic abstract class BaseEnemyState : State<EnemyController> {\r\n  protected BaseEnemyState(EnemyFSM fsm, EnemyController enemy) : base(fsm, enemy) { }\r\n}\r\npublic class DefaultState : BaseEnemyState {\r\n  public DefaultState(EnemyFSM fsm, EnemyController enemy) : base(fsm, enemy) { }\r\n}\r\n#endregion\r\n")],-1),Me=Object(a["h"])("h3",{id:"onenterpayload"},"OnEnter Payload",-1),xe=Object(a["h"])("p",null," One thing our original implementation lacks is the ability for our states to retrieve data via transitions. An example could be if you designed a knockback state for your player upon receiving damage and needed the specific attack data to control the physics behaviour of the hit. ",-1),Fe=Object(a["h"])("p",null,[Object(a["g"])(' We can accomplish this easily by introducing a "payload" parameter in our '),Object(a["h"])("code",null,"ChangeState"),Object(a["g"])(" methods that then gets passed to the State's "),Object(a["h"])("code",null,"OnEnter"),Object(a["g"])(" method. Here I am defining the payload as "),Object(a["h"])("code",null,"object"),Object(a["g"])(" and building a helper function to cast it. You could instead use a "),Object(a["h"])("code",null,"Dictionary"),Object(a["g"])(" if you prefer json-style data. ")],-1),Ce=Object(a["h"])("pre",null,[Object(a["h"])("code",{class:"csharp language-csharp"},"public class FiniteStateMachine {\r\n  ...\r\n  public void ChangeState(State state, object payload = null) {\r\n    if (currentState != null) {\r\n      currentState.OnExit();\r\n    }\r\n    currentState = state;\r\n    currentState.OnEnter(payload);\r\n  }\r\n  ...\r\n}\r\n\r\npublic abstract class State {\r\n  ...\r\n  // Helper func to fetch and get the payload\r\n  // will default if payload incorrectly is not found/casted\r\n  protected P CastPayload<P>(object payload, P defaultt = default(P)) {\r\n    try {\r\n      return (P) payload;\r\n    } catch {\r\n      return defaultt;\r\n    }\r\n  }\r\n  ...\r\n}\r\n")],-1),Pe=Object(a["h"])("p",null," One drawback of this is that loosely defined data structures is prone to regression bugs. As a solo developer I never ran into issues but in an expanding team of developers one can see how bugs could arise if the payload or the payload cast was changed independently of one another. Unit tests would catch this, but I know none of us are writing those. ",-1),Ie=Object(a["h"])("p",null," You could probably design a more robust payload system using generics but I have not attempted this yet since it was overkill for me. ",-1),Te=Object(a["h"])("h3",{id:"statepriority"},"State priority",-1),Ee=Object(a["h"])("p",null,[Object(a["g"])(" A more niche thing I've done before is introduce the concept of state priority such that during "),Object(a["h"])("code",null,"ChangeState"),Object(a["g"])(" the FSM will only ever change the current state if the next state's priority is greater. This is useful if you have many transitions into a single state that can occur under the same conditions. Instead of writing behaviour outside the FSM to decide if the state should be changed, this can easily be done in the FSM framework. To be honest I personally found this was mostly unused in my projects. ")],-1),De=Object(a["h"])("p",null,"Here is what the FSM and State would look like:",-1),Ue=Object(a["h"])("pre",null,[Object(a["h"])("code",{class:"csharp language-csharp"},"public class FiniteStateMachine {\r\n  ...\r\n  // now returns if the state changed successfully\r\n  public bool ChangeState(State state) {\r\n    if (currentState != null && currentState.priority > state.priority)\r\n      return false;\r\n    if (currentState != null) {\r\n      currentState.OnExit();\r\n    }\r\n    currentState = state;\r\n    currentState.OnEnter();\r\n    return true;\r\n  }\r\n  ...\r\n}\r\n\r\npublic abstract class State {\r\n  ...\r\n  public int priority {\r\n    get;\r\n    private set;\r\n  }\r\n\r\n  public State(FiniteStateMachine fsm, PlayerController player, int priority = -1) {\r\n    this.player = player;\r\n    this.fsm = fsm;\r\n    this.priority = priority;\r\n  }\r\n  ...\r\n}\r\n")],-1),Ae=Object(a["f"])('<h3 id="transitionextras">Transition extras</h3><p> Right now the implementation leaves states in the dark regarding why an outside transition occurred. </p><p> One useful thing we can do is allow our states to capture two pieces of information: </p><ol><li><p>the next/previous state that is being changed to:</p><p> a. The next/previous state is useful for specific use cases, but I would say that if this is needed more often than not it would probably be a better idea to go with a FSM framework that requires strictly defined transitions. </p></li><li><p>if this current state was interrupted:</p><p> a. This can be very important because it lets a state define the difference between a graceful exit and a forceful one. It&#39;s ultimately better to design your states such that your <code>OnExit</code> cleans up the state regardless of how it&#39;s exited, but this solution offers a quick shortcut to solve applicable edgecases. </p></li></ol>',4),ze=Object(a["h"])("pre",null,[Object(a["h"])("code",{class:"csharp language-csharp"},'// Models a FSM that has some extra transition data\r\npublic class FiniteStateMachine {\r\n  ...\r\n  /// <summary>\r\n  /// Change to new state\r\n  /// </summary>\r\n  /// <param name="state"></param>\r\n  /// <param name="source">The state that called for this change, default is null if the signal came from outside the FSM</param>\r\n  /// <returns>if state change was successful</returns>\r\n  public bool ChangeState(State state, State source = null) {\r\n    if (currentState != null && currentState.priority > state.priority)\r\n      return false;\r\n    if (currentState != null) {\r\n      interrupt = currentState != source\r\n      currentState.OnExit(interrupt, state);\r\n    }\r\n    previousState = state;\r\n    currentState = state;\r\n    currentState.OnEnter(previousState);\r\n    return true;\r\n  }\r\n  ...\r\n}\r\n\r\n// Models a FSM state that has some extra transition data\r\npublic abstract class State {\r\n  ...\r\n  /// <summary>\r\n  /// What to do on entering the state\r\n  /// </summary>\r\n  public abstract void OnEnter(State previousState);\r\n\r\n  /// <summary>\r\n  /// What to do on exiting the state\r\n  /// </summary>\r\n  public abstract void OnExit(bool interrupted, State nextState);\r\n\r\n  /// <summary>\r\n  /// Goes to a new state (Wrapper for ChangeState)\r\n  /// </summary>\r\n  public void Goto<S>() where S : State {\r\n    fsm.ChangeState<S>(this); // results in an uninterrupted exit\r\n  }\r\n  ...\r\n}\r\n')],-1),_e=Object(a["f"])('<h2 id="lessonslearned">Lessons learned</h2><ol><li><p> Writing poorly designed mechanically dense states in a FSM will simply offload your problems from the Update loop. The FSM is a tool but unlocking its potential is being able to effectively break down your controller into decoupled states. </p></li><li><p> Decide early where you want to store your player model. It may seem obvious to have all of your player functions and properties in their respective state classes. However if those same functions need to be accessible from other places you should consider moving them to your PlayerController. One core rule of this FSM implementation is to never directly call functions and data in your state classes. If you do this you&#39;ll quickly understand that it&#39;s messy and is considered a failure in state design. </p></li><li><p> Don&#39;t be afraid to use your engine&#39;s tools, they&#39;re there to help you make games faster and easier. I personally learned while writing this article how the <code>MonoBehaviour</code> approach to my FSM implementation is superior as it provides more functionality with less boilerplate code. </p></li></ol><h2 id="conclusion">Conclusion</h2><p> It is entirely possible to make a game with a single script for your player controller and it is not the determining factor for your games completion or success. Celeste is an example of a successful title <a href="https://github.com/NoelFB/Celeste/blob/master/Source/Player/Player.cs">that has a single 5400 lined player controller script,</a> but I have no doubt there were great difficulties revolving around this. While it is not the only or last example of this, every step we can make as developers to improve our technical skills will result in fewer times we are limited in creating the dream game we all desire to make. Using FSMs is but just one example of doing so by designing a robust player controller that allows you to develop easily understandable yet complex mechanics for your player while maintaining the integrity of your ever-expanding code. </p><p> All of the code examples in this article can be found <a href="https://github.com/mbitzos/devblog-code-examples/tree/main/fsm-player-controllers">here on my GitHub.</a></p>',5);function Be(e,t,n,r,o,i){var s=Object(a["z"])("PostImageComponent"),c=Object(a["z"])("CodeBlock");return Object(a["r"])(),Object(a["d"])("div",null,[re,Object(a["h"])("p",null,[Object(a["h"])(s,{class:"post-image",image:{uri:"posts/fsm-player-controllers/fsm-locked-door.jpg",subtitle:"A locked door in a game modelled as a basic FSM"}},null,8,["image"])]),Object(a["h"])("p",null,[Object(a["h"])(s,{class:"post-image",image:{uri:"posts/fsm-player-controllers/fsm-quest.jpg",subtitle:"A questline in an RPG modelled as a basic FSM"}},null,8,["image"])]),oe,ie,se,ce,Object(a["h"])(c,null,{default:Object(a["F"])((function(){return[le]})),_:1}),ue,de,Object(a["h"])(c,null,{default:Object(a["F"])((function(){return[he]})),_:1}),pe,Object(a["h"])(c,null,{default:Object(a["F"])((function(){return[me]})),_:1}),be,fe,ye,ge,Object(a["h"])(c,null,{default:Object(a["F"])((function(){return[Oe]})),_:1}),ve,je,Object(a["h"])(c,null,{default:Object(a["F"])((function(){return[Se]})),_:1}),we,Object(a["h"])(c,null,{default:Object(a["F"])((function(){return[ke]})),_:1}),Me,xe,Fe,Object(a["h"])(c,null,{default:Object(a["F"])((function(){return[Ce]})),_:1}),Pe,Ie,Te,Ee,De,Object(a["h"])(c,null,{default:Object(a["F"])((function(){return[Ue]})),_:1}),Ae,Object(a["h"])(c,null,{default:Object(a["F"])((function(){return[ze]})),_:1}),_e])}var qe={class:"post-image"};function Ge(e,t,r,o,i,s){return Object(a["r"])(),Object(a["d"])("div",qe,[Object(a["h"])("img",{src:n("1771")("./".concat(e.image.uri)),style:e.image.style||{}},null,12,["src"]),e.image.subtitle?(Object(a["r"])(),Object(a["d"])("div",{key:0,class:"subtitle is-6",innerHTML:e.image.subtitle},null,8,["innerHTML"])):Object(a["e"])("",!0)])}var We=Object(a["i"])({props:{image:{type:Object,required:!0}}});n("5bb1");We.render=Ge;var Le=We,He={class:"code-block",ref:"mySlot"};function Re(e,t,n,r,o,i){var s=Object(a["z"])("FontAwesomeIcon");return Object(a["r"])(),Object(a["d"])("div",He,[Object(a["h"])(s,{icon:"fa-regular fa-copy",class:"copy-icon",onClick:e.copy},null,8,["onClick"]),Object(a["y"])(e.$slots,"default")],512)}n("96cf");var Ne=n("1da1"),Ke=n("ad3d"),$e=Object(a["i"])({components:{FontAwesomeIcon:Ke["a"]},data:function(){return{code:""}},methods:{copy:function(){var e=this;return Object(Ne["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,navigator.clipboard.writeText(e.code);case 2:case"end":return t.stop()}}),t)})))()}},mounted:function(){this.code=this.$refs.mySlot.textContent}});n("cdf2");$e.render=Re;var Ye=$e,Je=Object(a["i"])({components:{PostImageComponent:Le,CodeBlock:Ye}});Je.render=Be;var Ze=Je,Ve=Object(a["m"])({title:"Using finite state machines to build scalable player controllers",tags:["code","c#","unity"],mainImage:{uri:"posts/fsm-player-controllers/cover.jpg",subtitle:"A very basic state machine for a platformer player controller"},date:new Date("2022-11-15T04:30:45.378Z"),component:Ze,key:"fsm-player-controllers"}),Xe=Ve,Qe=Object(a["f"])('<p> Hey everyone. My name is Michael, welcome to my devblog where I will be writing about my game development experience over the past 5 years. At the time of writing this I am taking a break from gamedev to focus on other things, one of which is this blog. </p><h2 id="background">Background</h2><p> My friends and I formed an indie game studio called Overlook Studios during our third year of university and began working on 2D games in Unity. With a seemingly endless supply of motivation and creativity, we were driven by passion and the desire to learn how to make games. </p><p> Over the years, we worked on various projects ranging from an atmospheric survival horror game to a rhythm-based beat-em-up roguelike. </p><p>The team:</p><ul><li>Michael Bitzos - Lead programmer</li><li><a href="https://www.artstation.com/pixelgrim" target="_blank">Adam Mawby</a> - Artist </li><li>Ben Petkovsek - Designer/Programmer</li><li>Cole Bondarewski - Music/SFX</li></ul><p>Now you might be asking:</p><p><em>&quot;What games did you release?&quot;</em></p><p>And the answer is:</p><p><strong>None.</strong></p><p> Even though our projects weren&#39;t finished, there is still a thousand hours of hard work, a hundred thousand lines of code, and a large repository of knowledge that can be learned from. </p><h2 id="purpose">Purpose</h2><p> My goal is to share my experiences as the lead programmer for my team as well as how I incorporated my education and professional experience as a software engineer into designing the systems for the various core gameplay frameworks, features, and mechanics needed for our projects. </p><p> This blog is for anyone with a decent understanding of programming who is struggling to make games because of the challenges they face writing clean, maintainable, and scalable code. There will be an overarching focus on the technical skills of making 2D games in the Unity engine. </p><p> With any luck, you can learn from some of the lessons I&#39;ve learned so that your technical abilities are not the reason you can&#39;t complete your dream game. </p><h2 id="conclusion">Conclusion</h2><p> If you continue to read this blog, thank you for following me, hopefully reading about my challenges will help you overcome yours. </p><p> If you have any questions feel free to contact me: <a href="mailto:m.bitzos@gmail.com">m.bitzos@gmail.com</a></p>',18);function et(e,t,n,r,o,i){return Object(a["r"])(),Object(a["d"])("div",null,[Qe])}var tt=Object(a["i"])({components:{PostImageComponent:Le,CodeBlock:Ye}});tt.render=et;var nt=tt,at=Object(a["m"])({title:"Introduction to my devblog",tags:["misc"],date:new Date("2022-10-10T16:42:08.476Z"),component:nt,key:"introductions"}),rt=at,ot=[Xe,rt],it=ot,st=Object(ae["l"])({data:function(){return{articles:it}},methods:{isSelected:function(e){return e.key==this.$route.name}}});n("44d2f");st.render=ne;var ct=st,lt=Object(a["i"])({components:{sidebar:ct},data:function(){return{open:!1}},methods:{toggleOpen:function(){this.open=!this.open}}});n("25c1");lt.render=V;var ut=lt,dt={class:"post"},ht={class:"title is-2"},pt={class:"datestamp"},mt=Object(a["g"])(" - "),bt={class:"taggs"},ft=Object(a["h"])("div",{class:"main-divider"},null,-1);function yt(e,t,n,r,o,i){var s,c=Object(a["z"])("PostImageComponent");return Object(a["r"])(),Object(a["d"])("div",dt,[Object(a["h"])("div",ht,Object(a["C"])(e.post.title),1),Object(a["h"])("div",null,[Object(a["h"])("span",pt,Object(a["C"])(null===(s=e.post.date)||void 0===s?void 0:s.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})),1),mt,Object(a["h"])("span",bt,[(Object(a["r"])(!0),Object(a["d"])(a["a"],null,Object(a["x"])(e.post.tags,(function(e){return Object(a["r"])(),Object(a["d"])("span",{class:"tagg",key:e}," ["+Object(a["C"])(e)+"] ",1)})),128))])]),e.post.mainImage?(Object(a["r"])(),Object(a["d"])(c,{key:0,class:"main-image",image:e.post.mainImage},null,8,["image"])):Object(a["e"])("",!0),ft,(Object(a["r"])(),Object(a["d"])(Object(a["A"])(e.post.component),{class:"main-content"}))])}var gt=n("1487"),Ot=n.n(gt),vt=Object(a["i"])({components:{PostImageComponent:Le},props:{post:{type:Object,required:!0}},mounted:function(){Ot.a.highlightAll()}});n("67c5");vt.render=yt;var jt=vt,St=it.map((function(e){return{path:e.key,name:e.key,component:jt,props:{post:e}}})),wt=(St[0],[{path:"/",name:"home",component:q},{path:"/devblog",name:"devblog",redirect:"/devblog/introductions",component:ut,children:St},{path:"/:pathMatch(.*)",name:"redirect",redirect:{name:"home"}}]),kt=Object(s["a"])({history:Object(s["b"])(),routes:wt}),Mt=kt,xt=n("be33"),Ft=n("11ca"),Ct=n("2753");n("b383"),xt["c"].add(Ft["a"],Ct["a"]),Object(a["c"])(i).use(Mt).component("font-awesome-icon",Ke["a"]).mount("#app")},cdf2:function(e,t,n){"use strict";n("5b33")},d0122:function(e,t,n){e.exports=n.p+"fonts/AkagiPro-Black.91adf9b7.ttf"},d6a1:function(e,t,n){e.exports=n.p+"img/fsm-quest.fc3e4030.jpg"},dc6b:function(e,t,n){},e06c:function(e,t,n){e.exports=n.p+"img/fsm-locked-door.8a24fb8f.jpg"},ef7d:function(e,t,n){e.exports=n.p+"img/cover.821cfbe3.jpg"},fc91:function(e,t,n){e.exports=n.p+"img/animation-curves.3b5fc057.gif"},fc94:function(e,t,n){"use strict";n("8ae2")}});
//# sourceMappingURL=app.081fa43a.js.map